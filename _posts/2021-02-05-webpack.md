---
layout: post
title: 'webpack相关内容'
date: 2021-02-05
author: 'Youzi'
catalog: true
tags:
  - JS
  - webpack
---

ww = webpack

# 关于 webpack

其实项目做了挺多的，但是我接触下来，多数都是用固有脚手架（像·vue-cli | create-react-app·）去构建的，或者部分是二次开发的，业务代码写的越多，构建方面的东西就越来越少了，下决心好好了解下·ww·。

·ww·首先可以看做是个模块打包机；不过它还具备一些分析项目结构，代码编译（像·TS | CSS 预编译语言·），代码优化的工具；·ww·最终输出的结果是·HTML | CSS | JS·这些浏览器可执行的代码包；概括一下·ww·的功能内容：

- 代码编译：·TS·编译成`JS`，`less`编译成`CSS`；
- 文件优化：代码压缩，代码优化，静态资源处理等；
- 代码分割：提取公共代码，代码按模块进行划分，提高首屏加载效率等等；
- 模块合并：模块的合并和分割；
- 热更新：·dev·环境时，项目的热更新；
- 代码校验：利用·git husky·等工具，可以添加提交钩子，在提交代码时校验格式风格，单元测试等等；
- 自动发布：devops 的一环，提交后可配置自动打包构建生产包并传输到发布系统上；

## ww 核心概念

- ·entry·：入口，执行开发环境或者生产环境构建时，将从入口文件开始，递归查找依赖包进行构建；
- ·output·：输出，经过一系列打包处理后，得到的最终代码包；
- ·loader·：模块转换器，用于把模块内容按照需求转换成新内容，常见的有·css-loader·；
- ·plugin·：插件，在 ww 构建流程中的特定时机，注入扩展逻辑来改变构建结果；

ww 中所有的文件都是模块，最后都会转换成按照 JS 的模块来加载；

## 从 0 开始配置 ww

### 初始化

初始化空项目，安装 ww，命令行工具，开发使用的服务器插件；

```bash
npm init
npm i webpack webpack-cli webpack-dev-server -D
```

ww 基础配置文件，·webpack.config.js·；

```javascript
const path = require('path');

module.exports = {
  // 区别生产/开发
  mode: 'development',
  // 入口
  entry: './src/index.js',
  output: {
    // 输出目录
    path: path.resolve(__dirname, 'dist'),
    // 输出文件名
    filename: 'bundle.js'
  }
};
```

- mode：·development | production·，生产模式下会做对应的优化；
- output：
  - path: 输出路径；
  - filename：·'[name].[hash].[chunkhash].[contenthash].js'·输出文件名，可以附加随机数等等；
- devtool：开发者工具，可以选择是否需要 map 文件用于调试用的等等；
  - eval：使用 eval 包裹模块代码，因为浏览器引擎还没实现模块化；
  - source-map：生成.map 文件；
  - inline：将.map 作为 dataURI 嵌入，不单独生成 map；
  - cheap：不包含列信息，也不包含 loader 的 sourcemap；
  - module：包含 loader 的 sourcemap；

```javascript
module.exports = {
  devServer: {
    contentBase: path.resolve(__dirname, 'dist'),
    host: 'localhost',
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://server-api',
        pathRewrite: { '^/api': '' }
      }
    }
  }
};
```

- DevServer：开发服务器的配置；
  - contentBase：开发服务器在哪个目录下启动；
  - port：端口；
  - proxy：请求代理，一般是为了避免跨域等问题；
- module：配置模块，用来配置不同文件的加载器；
  - loader：module 下一般有一个 rules 的属性，是一个数组，包含了对不同文件的 loader 配置；
    - test：正则匹配文件类型；
    - loader：该文件类型的使用的 loader 解析；
    - include：包含文件夹；
    - exclude：排除文件夹；
    - use：一个数组，包括了多个 loader，比如对 css 样式文件，需要同时调用`css-loader | style-loader`；数组内部的执行规则是从右到左，从下到上；
- plugin：插件；插件的内容可太多了，用到再说吧；

### 常用module配置


