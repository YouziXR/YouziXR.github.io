# ant-design-vue踩坑

## form相关

- `validator`这傻逼函数在方法内部不会报错；从而导致整个表单的`validate`失效，常见的问题有，内置校验器只会在`console`报错，不会在`view`层面体现，因为函数运行卡在了`validator`方法中，不会抛出异常（目前在issue里面看到的原因是因为校验函数必须调用`callback`方法，并且会一直等待`callback`方法被调用，如果内部报错了，很明显`callback`就不会正常被调用，导致校验器失效）

## a-tree相关

原生的树结构，需要注意一个坑；如果`checkStrictly === true`，会把子节点和祖先节点关联起来，通俗点说就是选择祖先节点了，它的子节点也会级联被选中，如果选择了子节点，会级联半选中祖先节点；第二种情况就会出现问题了，因为组件没有提供`halfChecked`，所以要自己手动定义个变量来保存这个半选中的值；有些时候这个半选中的值是有用的。像下面这张图中，其实节点`0-0, 0-0-1`是半选中状态的，但是没有提供`props`来获取，接着往下看；

![关联树实例](/img/in-post/antdv-trap/tree-sample.png)

- 怎么保存半选中状态的值？考虑到从子节点的选中状态，反过来找父节点去判断是不是半选中，其实尝试了下太麻烦了，所以就用原生的事件来做了；

  - 监听`@check`，参数包括`checkedKeys, e:{checked: bool, checkedNodes, node, event}`，全选中的状态直接取第一个参数`checkedKeys`就行，是个数组；半选中状态在参数`e.halfCheckedKeys`中保存，也是个数组，你甚至在文档里都找不到这个数组。

  - 这样就会衍生出另一个问题，在设置`defaultCheckedKeys`时，只能设置全选中的节点，半选中的状态是自动生成的；但是如果不触发`@check`事件，就肯定得不到半选中的节点集合，所以其实建议是第一次保存`checkedKeys`时，把`halfCheckedKeys`也存储下来